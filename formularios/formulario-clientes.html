<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Clientes - Senior Advisors</title>
    <link rel="icon" href="/assets/logo_preview.png" type="image/png">
    <link rel="stylesheet" href="formulario-clientes.css">
</head>
<body>
    <div class="backdrop-formulario" data-node-id="168-591">
        <!-- Logo -->
        <div class="logo-container" data-node-id="200-1066">
            <img src="../assets/logo_dark.png" alt="Logo Senior Advisors">
        </div>

        <!-- Back Button -->
        <a href="../contacto/contacto.html" class="back-button" data-node-id="370-778"> 
            <div class="back-icon">
                <img src="../assets/arrow_back.svg" alt="Back">
            </div>
            <span>volver</span>
        </a>

        <!-- Main Form Container -->
        <div class="form-container" data-node-id="200-878">
            <!-- Header -->
            <h1 class="form-title" data-node-id="200-880">¿Hablamos?</h1>
            <p class="form-subtitle" data-node-id="200-879">Solicita una reunión</p>
            <p class="form-description" data-node-id="200-882">Solicita una runión y descubre cómo nuestros profesionales sénior pueden ayudarte a transformar tus retos en oportunidades reales</p>

            <!-- Form Fields -->
            <form class="registration-form" id="clientesForm">
                
                <!-- Empresa -->
                <div class="form-field" data-node-id="338-890">
                    <label>Empresa <span class="required">*</span></label>
                    <input type="text" name="empresa" data-node-id="338-892" required>
                </div>

                <!-- Nombre -->
                <div class="form-field" data-node-id="200-883">
                    <label>Nombre <span class="required">*</span></label>
                    <input type="text" name="nombre" data-node-id="200-885" required>
                </div>

                <!-- Apellidos -->
                <div class="form-field" data-node-id="200-886">
                    <label>Apellidos<span class="required"> *</span></label>
                    <input type="text" name="apellidos" data-node-id="200-888" required>
                </div>

                <!-- Correo electrónico -->
                <div class="form-field" data-node-id="200-889">
                    <label>Correo electrónico<span class="required"> *</span></label>
                    <input type="email" name="email" data-node-id="200-891" required>
                </div>

                <!-- Teléfono -->
                <div class="form-field" data-node-id="200-892">
                    <label>Teléfono <span class="required">*</span></label>
                    <input type="tel" name="telefono" data-node-id="200-894" required>
                </div>

                <!-- Dirección Section -->
                <h3 class="section-title" data-node-id="200-895">Dirección</h3>

                <!-- Calle -->
                <div class="form-field" data-node-id="200-897">
                    <label>Calle <span class="required">*</span></label>
                    <input type="text" name="calle" data-node-id="200-899" required>
                </div>

                <!-- Municipio -->
                <div class="form-field" data-node-id="200-900">
                    <label>Municipio <span class="required">*</span></label>
                    <input type="text" name="municipio" data-node-id="200-902" required>
                </div>

                <!-- Código postal -->
                <div class="form-field" data-node-id="200-903">
                    <label>Código postal <span class="required">*</span></label>
                    <input type="text" name="codigo_postal" data-node-id="200-905" required>
                </div>

                <!-- Divider Line -->
                <div class="divider-line" data-node-id="200-934"></div>

                <!-- Tipo de servicio -->
                <label class="standalone-label" data-node-id="200-907">¿Qué tipo de servicio busca?</label>

                <div class="service-areas-container">
                    <div class="service-column" data-node-id="200-957">
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Estrategia y evolución de la compañía" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Estrategia y evolución de la compañía</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Estrategia de talento, organización y planes de sucesión" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Estrategia de talento, organización y planes de sucesión</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Posicionamiento estratégico en el mercado" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Posicionamiento estratégico en el mercado</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Tendencias tecnológicas e impacto en el modelo de negocio" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Tendencias tecnológicas e impacto en el modelo de negocio</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Madurez tecnológica" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Madurez tecnológica</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Otros" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Otros</label>
                        </div>
                    </div>
                    <div class="service-column" data-node-id="200-976">
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Gestión de riesgos y solvencia financiera" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Gestión de riesgos y solvencia financiera</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Internacionalización" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Internacionalización</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Evolución y profesionalización de la empresa familiar" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Evolución y profesionalización de la empresa familiar</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Supply chain" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Supply chain</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Compromiso social y 3er sector" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Compromiso social y 3er sector</label>
                        </div>
                        <div class="checkbox-item" data-checkbox>
                            <input type="checkbox" name="tipo_servicio[]" value="Importación / Exportación" class="hidden-checkbox">
                            <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                            <label>Importación / Exportación</label>
                        </div>
                    </div>
                </div>

                <!-- Disponibilidad -->
                <label class="standalone-label availability-label" data-node-id="200-896"><span class="label-text">Disponibilidad</span><span class="required"> *</span></label>
                
                <div class="weekdays-container" data-node-id="200-917">
                    <div class="checkbox-item" data-checkbox>
                        <input type="checkbox" name="disponibilidad[]" value="Lunes" class="hidden-checkbox">
                        <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                        <label>Lunes</label>
                    </div>
                    <div class="checkbox-item" data-checkbox>
                        <input type="checkbox" name="disponibilidad[]" value="Martes" class="hidden-checkbox">
                        <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                        <label>Martes</label>
                    </div>
                    <div class="checkbox-item" data-checkbox>
                        <input type="checkbox" name="disponibilidad[]" value="Miercoles" class="hidden-checkbox">
                        <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                        <label>Miercoles</label>
                    </div>
                    <div class="checkbox-item" data-checkbox>
                        <input type="checkbox" name="disponibilidad[]" value="Jueves" class="hidden-checkbox">
                        <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                        <label>Jueves</label>
                    </div>
                    <div class="checkbox-item" data-checkbox>
                        <input type="checkbox" name="disponibilidad[]" value="Viernes" class="hidden-checkbox">
                        <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon">
                        <label>Viernes</label>
                    </div>
                </div>

                <!-- Resuma brevemente -->
                <label class="standalone-label" data-node-id="200-953">Resuma brevemente aquello que busca mejorar en su compañía <span class="required">*</span></label>
                <p class="helper-text" data-node-id="200-954">*Esta información será util para ponerle en contacto con el Senior Advisor que mejor se ajuste a sus necesidades.</p>
                <textarea class="textarea-medium" name="resumen" data-node-id="200-937" required></textarea>

                <!-- Otros comentarios -->
                <label class="standalone-label" data-node-id="200-1028">Otros comentarios de interés que creas importantes de resaltar</label>
                <textarea class="textarea-small" name="comentarios" data-node-id="200-939"></textarea>

                <!-- Privacy Policy -->
                <div class="privacy-checkbox" data-checkbox data-node-id="200-1029">
                    <input type="checkbox" name="privacy_policy" class="hidden-checkbox" required>
                    <img src="../assets/check_box_outline_blank.svg" alt="Unchecked" class="checkbox-icon" data-node-id="200-1031">
                    <label data-node-id="200-1030">He leido y acepto la <a href="#" class="privacy-link" id="openPrivacyModalClientes">política de privacidad de datos</a> de Senior Advisors Movilizadores SL</label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-button" data-node-id="200-881">
                    <span>enviar</span>
                    <div class="submit-arrow">
                        <img src="../assets/arrow_back.svg" alt="Arrow">
                    </div>
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const clientesForm = document.getElementById('clientesForm');
            
            // Handle checkbox clicks
            const checkboxItems = document.querySelectorAll('[data-checkbox]');
            const checkedImg = '../assets/check_box.svg';
            const uncheckedImg = '../assets/check_box_outline_blank.svg';
            
            checkboxItems.forEach(item => {
                item.addEventListener('click', function() {
                    const checkbox = this.querySelector('.hidden-checkbox');
                    const icon = this.querySelector('.checkbox-icon');
                    
                    // Toggle checkbox
                    checkbox.checked = !checkbox.checked;
                    
                    // Update icon
                    if (checkbox.checked) {
                        icon.src = checkedImg;
                        icon.alt = 'Checked';
                    } else {
                        icon.src = uncheckedImg;
                        icon.alt = 'Unchecked';
                    }
                });
            });
            
            if (clientesForm) {
                clientesForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Check required fields
                    const requiredFields = this.querySelectorAll('input[required]:not([type="checkbox"]), textarea[required]');
                    let allFilled = true;
                    
                    requiredFields.forEach(field => {
                        if (!field.value.trim()) {
                            allFilled = false;
                        }
                    });
                    
                    if (!allFilled) {
                        alert('Por favor, complete todos los campos obligatorios marcados con *');
                        return false;
                    }

                    // Check at least one disponibilidad checkbox is checked (REQUIRED FIELD)
                    const disponibilidadChecked = this.querySelectorAll('input[name="disponibilidad[]"]:checked');
                    if (disponibilidadChecked.length === 0) {
                        alert('Por favor, seleccione al menos un día de disponibilidad. Este campo es obligatorio.');
                        return false;
                    }

                    // Check privacy policy checkbox
                    const privacyCheckbox = this.querySelector('input[name="privacy_policy"]');
                    if (!privacyCheckbox.checked) {
                        alert('Debe aceptar la política de privacidad para continuar.');
                        return false;
                    }

                    // Email validation
                    const email = this.querySelector('input[name="email"]').value;
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        alert('Por favor, introduzca una dirección de correo electrónico válida.');
                        return false;
                    }

                    // Collect form data
                    const formData = {
                        formType: 'reunion',
                        empresa: this.querySelector('input[name="empresa"]').value.trim(),
                        nombre: this.querySelector('input[name="nombre"]').value.trim(),
                        apellidos: this.querySelector('input[name="apellidos"]').value.trim(),
                        email: email,
                        telefono: this.querySelector('input[name="telefono"]').value.trim(),
                        calle: this.querySelector('input[name="calle"]').value.trim(),
                        municipio: this.querySelector('input[name="municipio"]').value.trim(),
                        codigo_postal: this.querySelector('input[name="codigo_postal"]').value.trim(),
                        tipo_servicio: Array.from(this.querySelectorAll('input[name="tipo_servicio[]"]:checked')).map(cb => cb.value),
                        disponibilidad: Array.from(disponibilidadChecked).map(cb => cb.value),
                        resumen: this.querySelector('textarea[name="resumen"]').value.trim(),
                        comentarios: this.querySelector('textarea[name="comentarios"]').value.trim() || null
                    };

                    // Disable submit button
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span>enviando...</span>';

                    try {
                        const response = await fetch('/.netlify/functions/send_email', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('¡Gracias por su solicitud! Nos pondremos en contacto con usted pronto.');
                            this.reset();
                            // Reset checkbox icons
                            checkboxItems.forEach(item => {
                                const icon = item.querySelector('.checkbox-icon');
                                icon.src = uncheckedImg;
                                icon.alt = 'Unchecked';
                            });
                            // Redirect to home page
                            window.location.href = '../index.html';
                        } else {
                            throw new Error(result.error || 'Error al enviar el formulario');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Hubo un error al enviar su solicitud. Por favor, intente nuevamente.');
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                    }
                });
            }
        });
    </script>

    <!-- Privacy Modal Overlay -->
    <div id="privacyModalClientes" class="privacy-modal-overlay">
        <div class="privacy-modal-content">
            <button class="privacy-modal-close" id="closePrivacyModalClientes" aria-label="Cerrar">&times;</button>
            <div class="privacy-modal-body">
                <h2>Política de Privacidad</h2>

                <h3>1. Identidad del responsable</h3>
                <p>Entidad: Senior Advisors Movilizadores S.L.</p>
                <p>NIF: B-23872336</p>
                <p>Correo electrónico: mjomargo@gmail.com</p>
                <p>Teléfono: 600936501</p>

                <h3>2. Datos que recabamos</h3>
                <p>Recabamos información mediante los formularios de Clientes, Potenciales Clientes y Proveedores.</p>

                <h3>3. Finalidades del tratamiento</h3>
                <ul>
                    <li>Clientes: prestación de servicios y facturación.</li>
                    <li>Potenciales clientes: atender solicitudes de información y comunicaciones comerciales con consentimiento.</li>
                    <li>Proveedores: gestión de pedidos y facturación.</li>
                </ul>

                <h3>4. Base legal</h3>
                <p>Consentimiento, ejecución de contrato y obligación legal según corresponda.</p>

                <h3>5. Gestión técnica</h3>
                <p>Los datos se envían mediante funciones personalizadas de JS en Netlify y solo personal autorizado los gestiona.</p>

                <h3>6. Conservación</h3>
                <ul>
                    <li>Clientes y proveedores: mientras dure la relación comercial y plazos legales.</li>
                    <li>Potenciales clientes: hasta que se solicite supresión.</li>
                </ul>

                <h3>7. Derechos del usuario</h3>
                <p>Acceso, rectificación, supresión, limitación, oposición y portabilidad mediante correo a mjomargo@gmail.com.</p>

                <h3>8. Cláusulas informativas específicas</h3>
                <p><strong>Clientes:</strong> Prestar el servicio solicitado y facturación. Consentimiento de publicidad: SI / NO</p>
                <p><strong>Potenciales clientes:</strong> Información solicitada y comunicaciones comerciales/eventos. Consentimiento: SI / NO</p>
                <p><strong>Proveedores:</strong> Pedidos y facturación.</p>

                <h2>Términos y Condiciones de los Formularios</h2>

                <h3>1. Objeto</h3>
                <p>Regula las condiciones del envío de información mediante los formularios de la web.</p>

                <h3>2. Uso de los formularios</h3>
                <p>Enviar información implica aceptación de la Política de Privacidad y Términos. Los datos deben ser veraces.</p>

                <h3>3. Protección y confidencialidad</h3>
                <p>Datos tratados de forma confidencial y solo accesibles por personal autorizado.</p>

                <h3>4. Responsabilidad</h3>
                <p>Senior Advisors Movilizadores S.L. no se responsabiliza por envío incorrecto de datos ni información de terceros.</p>

                <h3>5. Modificaciones</h3>
                <p>Los términos y la política pueden ser modificados y se publicarán en la web.</p>
            </div>
        </div>
    </div>

    <script>
        // Privacy Modal Handler for Clientes Form
        document.addEventListener('DOMContentLoaded', function() {
            const privacyModal = document.getElementById('privacyModalClientes');
            const openPrivacyLink = document.getElementById('openPrivacyModalClientes');
            const closePrivacyBtn = document.getElementById('closePrivacyModalClientes');
            const privacyCheckbox = document.querySelector('input[name="privacy_policy"]');
            const privacyCheckboxContainer = document.querySelector('.privacy-checkbox[data-checkbox]');

            if (openPrivacyLink) {
                openPrivacyLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (privacyModal) {
                        privacyModal.style.display = 'flex';
                        document.body.style.overflow = 'hidden';
                    }
                });
            }

            if (closePrivacyBtn) {
                closePrivacyBtn.addEventListener('click', function() {
                    if (privacyModal) {
                        privacyModal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            }

            if (privacyModal) {
                privacyModal.addEventListener('click', function(e) {
                    if (e.target === privacyModal) {
                        privacyModal.style.display = 'none';
                        document.body.style.overflow = '';
                    }
                });
            }

            // Prevent checkbox toggle when clicking the link
            if (privacyCheckboxContainer && openPrivacyLink) {
                openPrivacyLink.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
    </script>
</body>
</html>
